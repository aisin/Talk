extends ../common/layout

block prepend style
    link(href="/simditor/styles/simditor.css", rel="stylesheet")
    link(href="/css/weui.css", rel="stylesheet")
    link(href="/essage/essage.css", rel="stylesheet")

block header
    include ../common/header
block append main
    #banner.banner.main
        .container
            a(href="/")
                img(src="http://gold.xitu.io/images/banners/app_2.0.png")
    .main
        .navigation
            .container
                a.now(href="#") 热门
                a(href="#") 最新
                a(href="#") 精华
    .wrap
        //.hd
            .page_title Talk
            .page_desc Login for Talk
        form#newThreadForm.bd
            .weui_cells_title 发布主题
            .weui_cells.weui_cells_form
                .weui_cell
                    .weui_cell_hd
                        label.weui_label 主题标题
                    .weui_cell_bd.weui_cell_primary
                        input#title.weui_input(type="text", name="title", value)
                .weui_cell
                    .weui_cell_bd.weui_cell_primary
                        textarea#editor(autofocus)
                    input#content(type="hidden", name="content")
            .weui_btn_area
                input#submit.weui_btn.weui_btn_primary(type="button" value="发布主题")

block footer
    include ../common/footer

block append script
    script(type="text/javascript", src="/simditor/scripts/module.js")
    script(type="text/javascript", src="/simditor/scripts/hotkeys.js")
    script(type="text/javascript", src="/simditor/scripts/uploader.js")
    script(type="text/javascript", src="/simditor/scripts/simditor.js")
    script(type="text/javascript", src="/essage/essage.js")
    script(type="text/javascript").
        var editor = new Simditor({
            textarea: $('#editor'),
            placeholder: 'hehehe this is root',
            defaultImage: 'images/image.png'
        });

        $(function(){
            $('#submit').click(function(){
                var title = $('#title').val();
                var content = editor.getValue();
                if(!title){
                    Essage.show({
                        message: '主题标题不能为空',
                        status: 'error'
                    }, 2000);
                }else if(!content){
                    Essage.show({
                        message: '主题内容不能为空',
                        status: 'error'
                    }, 2000);
                }else if(content.length > 1000){
                    Essage.show({
                        message: '主题内容不能超过 1000 个字符',
                        status: 'error'
                    }, 2000);
                }else{
                    $('#content').val(content);
                    var formVal = $('#newThreadForm').serialize();
                    $.post('/thread/new', formVal, function (data) {
                        if (data.status == 1) {
                            Essage.show({
                                message: data.msg,
                                status: 'success',
                                redirect : '/'
                            }, 2000);
                        } else {
                            Essage.show({
                                message: data.msg,
                                status: 'error'
                            }, 2000);
                        }
                    }, 'json');
                }
            });
        });